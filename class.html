<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>ATOC-5235</title>

    <meta name="description" content="ATOC-5235">
    <meta name="author" content="Hong Chen">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="reveal.js/css/reveal.css">
    <link rel="stylesheet" href="my/reveal.js/css/theme/science.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>


  <body>
    <div class="reveal">
      <div class="slides">

        <section>
          <h3>ATOC 5235 - Week 2 - 2018/01/23</h3>
          <section data-markdown>
            - Skywatch & SPN1 Intro</p>

            - Download SPN1 Data</p>

            - Read SPN1 Data</p>

            - Analyze and Plot</p>
          </section>
        </section>

        <section>
          <h3>Skywatch</h3>
          <br>
          <img data-src="data/class/east.JPG"></img>
          <p style="font-size:100%;"><a href="http://skywatch.colorado.edu/">skywatch.colorado.edu</a></p>
        </section>

        <section>
          <h3>Total & Diffuse Pyranometer (SPN1)</h3>
          <br>
          <img height="300" data-src="data/class/SPN1-1.png"></img>
          <p style="font-size:80%;">Measures total and diffuse components of incident solar radiation</p>
        </section>

        <section>
          <h3>How to Download SPN1 Data?</h3>
          <section data-markdown>
            <script type="text/template">
              <br>
              - Go to [__skywatch.colorado.edu__](http://skywatch.colorado.edu/)

              - Click __Archives__ at the left panel

              - In Instrument, pick __Total/Diffuse Pyranometer__

              - Pick a date, e.g., Year __2017__, Month __August__, day __21__

              - Click __submit__

              - Scroll down until __file__ shows up, right click on __file__ and __Save Link As...__
            </script>
          </section>

          <section>
            <a href="http://skywatch.colorado.edu/" data-preview-link>In-Class Demo</a>
          </section>
        </section>

        <section>
          <h3>Explore the Data <span style="font-size:60%; color:SeaGreen">spn_17_08_21.dat</span></h3>
          <section data-markdown>
            ```markdown
            ;Sunshine Pyranometer SPN1
            ;Skywatch ground facility
            ;Department of Atmospheric and Oceanic Sciences
            ;University of Colorado at Boulder
            ;start time = 2017-08-21 05:30:00 (local mountain time)
            ;Time(UTC), Total Irradiance(W/m^2), Diffuse Irradiance(W/m^2), Sunshine (True or False)
            11:30:05,    2.6,     1.4, 0
            11:30:10,    2.7,     1.4, 0
            11:30:15,    2.7,     1.5, 0
            11:30:20,    2.6,     1.4, 0
            11:30:25,    2.1,     1.4, 0
            11:30:31,    1.9,     0.0, 0
            11:30:36,    2.7,     1.4, 0
            11:30:41,    2.7,     1.4, 0
            11:30:46,    2.6,     1.4, 0
            11:30:51,    1.3,     0.0, 0
            11:30:56,    2.7,     1.4, 0
            11:31:01,    2.7,     1.4, 0
            11:31:06,    1.3,     0.0, 0
            11:31:11,    2.0,     1.4, 0
            ```
          </section>

          <section data-markdown>
            #### Header
            ```markdown
            ;Sunshine Pyranometer SPN1
            ;Skywatch ground facility
            ;Department of Atmospheric and Oceanic Sciences
            ;University of Colorado at Boulder
            ;start time = 2017-08-21 05:30:00 (local mountain time)
            ;Time(UTC), Total Irradiance(W/m^2), Diffuse Irradiance(W/m^2), Sunshine (True or False)
            ```
          </section>

          <section data-markdown>
            #### Body
            ```markdown
            11:30:05,    2.6,     1.4, 0
            11:30:05,    2.6,     1.4, 0
            11:30:10,    2.7,     1.4, 0
            11:30:15,    2.7,     1.5, 0
            11:30:20,    2.6,     1.4, 0
            11:30:25,    2.1,     1.4, 0
            11:30:31,    1.9,     0.0, 0
            11:30:36,    2.7,     1.4, 0
            11:30:41,    2.7,     1.4, 0
            11:30:46,    2.6,     1.4, 0
            11:30:51,    1.3,     0.0, 0
            ```
            Comma-Separated Values (CSV)
          </section>
        </section>

        <section>
          <h3>Python Intro <span style="font-size:60%; color:SeaGreen">List</span></h3>

          <section data-markdown>
              #### Defined by `[]`

              ```python
              a = ["10", 10, 10.0, None, 10+10j]

              b = [print, type, float]

              c = [a, b]
              ```
          </section>

          <section data-markdown>
              #### Indexing

              ```python
              # index  0/-5    1/-4   2/-3   3/-2    4/-1
              a    = [ "10",    10,   10.0,  None,  10+10j]

              # a[0] or a[-5] is "10"
              # a[1] or a[-4] is 10
              # a[2] or a[-3] is 10.0
              # a[3] or a[-2] is None
              # a[4] or a[-1] is 10+10j
              ```
          </section>

          <section data-markdown>
              #### Slicing
              ```python
              # index    0      1       2      3       4
              a    = [ "10",    10,   10.0,  None,  10+10j]

              # a[0:1] is "10"
              # a[0:2] are "10", 10
              # a[0:3] are "10", 10, 10.0
              # a[3:] are None, 10+10j
              ```
              What about the following?

              ```python
              a[::-1] = ?
              a[::2]  = ?
              ```
          </section>

          <section data-markdown>
              #### Functions

              ```python
              a = ["10", 10, 10.0, None, 10+10j]

              a.append("haha")
              # now a = ["10", 10, 10.0, None, 10+10j, "haha"]

              a.insert(0, "haha")
              # now a = ["haha", "10", 10, 10.0, None, 10+10j, "haha"]

              len(a)
              # return the number of elements in the list, here 7
              ```
          </section>
        </section>

        <section>
          <h3>Python Intro <span style="font-size:60%; color:SeaGreen">String</span></h3>

          <section data-markdown>
              #### Defined by `''` or `""`

              ```python
              a = "Hello my name is Hong Chen"

              name = "Hong Chen"
              b = "Hello my name is {0:s}".format(name)

              c = "Hello my name is %s" % name
              ```
          </section>

          <section data-markdown>
              #### Indexing

              ```python
              a = "Hello my name is Hong Chen"

              # a[0] is 'H'
              # a[1] is 'e'
              # a[2] is 'l'
              # ...
              # a[-1] is 'n'
              ```
          </section>

          <section data-markdown>
              #### Slicing
              ```python
              a = "Hello my name is Hong Chen"

              # a[0:5] is "Hello"
              # a[0:6] is "Hello "
              # a[6:8] is "my"
              # a[17:] is "Hong Chen"
              ```
              What about the following?

              ```python
              a[::-1] = ?
              a[::2]  = ?
              ```
          </section>

          <section data-markdown>
              #### Functions

              ```python
              a = "Hello my name is Hong Chen"

              len(a)
              # returns the length of the string, here 26

              a.split(" ")
              # returns the list ['Hello', 'my', 'name', 'is', 'Hong', 'Chen']

              a.lower()
              # returns "hello my name is hong chen"

              a.upper()
              # returns "HELLO MY NAME IS HONG CHEN"

              a.replace("Hong Chen", "Sebastian Schmidt")
              # returns "Hello my name is Sebastian Schmidt"

              "     haha     ".strip()
              # removes white spaces, returns "haha"

              "10".zfill(10)
              # fills zeros at the beginning, returns "0000000010"
              ```
          </section>
        </section>

        <section>
          <h3>Read the Data using Python <span style="font-size:60%; color:SeaGreen">eclipse_v1.py</span></h3>
          <section data-markdown>
            <script type="text/template">
              #### Functions that are used:
              <br>

              [`open`](https://docs.python.org/3/library/functions.html#open),
              [`len`](https://docs.python.org/3/library/functions.html#len),
              [`print`](https://docs.python.org/3/library/functions.html#print)

              <br>

              [Input/Output](https://docs.python.org/3/tutorial/inputoutput.html),
              [List](https://docs.python.org/3/tutorial/datastructures.html#more-on-lists),
              [String](https://docs.python.org/3/library/string.html)
            </script>
          </section>

          <section>
            <h4>Part I: Read in Data</h4>
            <pre><code class="python hljs" data-trim contenteditable data-noescape>
# file name, relative path
fname = 'spn_17_08_21.dat' # needs to be downloaded from Skywatch first
                           # Note: there is alternate (more complicated) code
                           # where the data is directly downloaded from the web

# open text file to read
f = open(fname,'r')

# read all lines into list of strings "lines"
lines = f.readlines() # () tells python it's a function not an attribute --> execute

f.close()

nLine = len(lines)
print("There are {0:d} lines in file \"{1:s}\".".format(nLine, fname))

# Loop over the lines in the file and read out content.
time   = [] # initialize list for times
total  = [] # initialize list for total irradiance
for line in lines:

    # ";" is used as a comment in the data file; ignore!
    if line[0] != ";":

        entries = line.split(",") # Split one line (string) into sub-strings using "," as separator.

        time0  = entries[0]

        hour   = time0[0:2]
        minute = time0[3:5]
        second = time0[6:8]
        # Or use the following
        # hour, minute, second = time0.split(":")
        time0  = float(hour) + float(minute)/60.0 + float(second)/3600.0

        total0 = entries[1]
        total0 = float(total0)

        time.append(time0)
        total.append(total0)
            </code></pre>
          </section>

          <section>
            <h4>Part II: Analyze</h4>
            <pre><code class="python hljs" data-trim contenteditable data-noescape>
# need this for "where" statement that works only on arrays
import numpy as np
time = np.array(time)
next_day=np.where(time < 7) # This is not quite clean, cut off at locat midnight
time[next_day]=time[next_day]+24.
            </code></pre>
          </section>

          <section>
            <h4>Part III: Plot</h4>
            <pre><code class="python hljs" data-trim contenteditable data-noescape>
# Now do the plotting
import matplotlib.pyplot as plt
fig=plt.figure(figsize=(6,6))
plt.plot(time, total, marker='o', markersize=1)
plt.xlabel('UTC [hour]')
plt.ylabel('Irradiance [$\mathrm{W m^{-2} nm^{-1}}$]')
plt.title('Solar Eclipse')
plt.show()
            </code></pre>
          </section>
        </section>

        <section>
          <h3>Read the Data using Python <span style="font-size:60%; color:SeaGreen">eclipse_v2.py</span></h3>
          <section>
            <h4>In-Class Practice: Read in Diffuse</h4>
            <pre><code class="python hljs" data-trim contenteditable data-noescape>
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Read in Skywatch eclipse data (skywatch.colorado.edu) and make simple plot.
Here, diffuse irradiance is also read in (student task)
"""

# file name, relative path
fname = 'spn_17_08_21.dat' # needs to be downloaded from Skywatch first
                           # Note: there is alternate (more complicated) code
                           # where the data is directly downloaded from the web

# open text file to read
f = open(fname,'r')

# read all lines into list of strings "lines"
lines = f.readlines() # () tells python it's a function not an attribute --> execute

f.close()

nLine = len(lines)
print("There are {0:d} lines in file \"{1:s}\".".format(nLine, fname))

# Loop over the lines in the file and read out content.
time    = [] # initialize list for times
total   = [] # initialize list for total irradiance
<mark>#***********</mark> # initialize list for diffuse irradiance
for line in lines:

    # ";" is used as a comment in the data file; ignore!
    if line[0] != ";":

        entries = line.split(",") # Split one line (string) into sub-strings using "," as separator.

        time0  = entries[0]

        hour   = time0[0:2]
        minute = time0[3:5]
        second = time0[6:8]
        # Or use the following
        # hour, minute, second = time0.split(":")
        time0    = float(hour) + float(minute)/60.0 + float(second)/3600.0

        total0   = entries[1]
        total0   = float(total0)

        <mark>#********************</mark>
        <mark>#********************</mark>

        time.append(time0)
        total.append(total0)
        <mark>#********************</mark>

# need this for "where" statement that works only on arrays
import numpy as np
time = np.array(time)
next_day=np.where(time < 7) # This is not quite clean, cut off at locat midnight
time[next_day]=time[next_day]+24.

# Now do the plotting
import matplotlib.pyplot as plt
fig=plt.figure(figsize=(6,6))
plt.plot(time, total  , marker='o', markersize=1, label='Total')
<mark>#****************************************************************</mark>
plt.xlabel('UTC [hour]')
plt.ylabel('Irradiance [$\mathrm{W m^{-2} nm^{-1}}$]')
plt.title('Solar Eclipse')
plt.legend()
plt.show()
            </code></pre>
          </section>

          <section>
            <h4>Result</h4>
            <img data-src="data/class/SPN1_v2.png" width="600"></img>
          </section>
        </section>

        <section>
          <h3>Read the Data using Python <span style="font-size:60%; color:SeaGreen">eclipse_v3.py</span></h3>

          <section data-markdown>
            #### Install `pysolar`
            ```bash
            conda install -c conda-forge pysolar
            ```
          </section>

          <section>
            <h4>Add Total Irradiance at TOA</h4>
            <pre><code class="python hljs" data-trim contenteditable data-noescape>
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Read in Skywatch eclipse data (skywatch.colorado.edu) and make simple plot.
Here, diffuse irradiance is also read in,
and the solar zenith angle is calculated. Subsequently, the TOA irradiance
is overplotted.
"""

import numpy as np
import matplotlib.pyplot as plt
from datetime import datetime, timezone, timedelta
from pysolar import solar

# file name, relative path
fname = 'spn_17_08_21.dat' # needs to be downloaded from Skywatch first
                           # Note: there is alternate (more complicated) code
                           # where the data is directly downloaded from the web

# extract year, month, day from the file name
year_s, month_s, day_s = (fname.split(".")[0]).split("_")[1:]
year  = int(year_s)+2000
month = int(month_s)
day   = int(day_s)

# open text file to read
f = open(fname,'r')

# read all lines into list of strings "lines"
lines = f.readlines() # () tells python it's a function not an attribute --> execute

f.close()

nLine = len(lines)
print("There are {0:d} lines in file \"{1:s}\".".format(nLine, fname))

# Loop over the lines in the file and read out content.
dtime   = [] # initialize list for datetime objects
total   = [] # initialize list for total irradiance
diffuse = [] # initialize list for diffuse irradiance
for line in lines:

    # ";" is used as a comment in the data file; ignore!
    if line[0] != ";":

        entries = line.split(",") # Split one line (string) into sub-strings using "," as separator.

        time0  = entries[0]
        hour   = int(time0[0:2])
        minute = int(time0[3:5])
        second = int(time0[6:8])
        dtime0 = datetime(year, month, day, hour, minute, second, tzinfo=timezone.utc)
        if hour < 7:
            dtime0 += timedelta(days=1)

        total0   = entries[1]
        total0   = float(total0)

        diffuse0 = entries[2]
        diffuse0 = float(diffuse0)

        dtime.append(dtime0)
        total.append(total0)
        diffuse.append(diffuse0)

# calculate the total irradiance at top of atmosphere
<mark>lon = -105.27</mark>
<mark>lat = 40.0</mark>
<mark>ele = 1600.0</mark>
<mark>sza = [] # initialize list for solar zenith angle</mark>
<mark>for dtime0 in dtime:</mark>
    <mark>sza0 = 90.0 - solar.get_altitude(lat, lon, dtime0, elevation=ele)</mark>
    <mark>sza.append(sza0)</mark>

# np.array(sza): convert sza from list to array
# np.deg2rad() : convert angle from degrees to radians
# np.cos()     : calculate cosine value
<mark>total_toa = 1361.0 * np.cos(np.deg2rad(np.array(sza)))</mark>

# plot
fig=plt.figure(figsize=(10,6))
plt.plot(dtime, total    , marker='o', markersize=1, label='Total (SPN1)')
plt.plot(dtime, diffuse  , marker='o', markersize=1, label='Diffuse (SPN1)')
<mark>plt.plot(dtime, total_toa, marker='o', markersize=1, label='Total (TOA)')</mark>
plt.ylim(bottom=0)
plt.xlabel('Date/Time')
plt.ylabel('Irradiance [$\mathrm{W m^{-2} nm^{-1}}$]')
plt.title('Solar Eclipse')
plt.legend()
plt.show()
            </code></pre>
          </section>

          <section>
            <h4>Result</h4>
            <img data-src="data/class/SPN1_v3.png" width="600"></img>
          </section>
        </section>

        <!-- End -->
        <section style="text-align: left;">
            <h1>THE END</h1>
        </section>

      </div>
    </div>

    <script src="reveal.js/lib/js/head.min.js"></script>
    <script src="reveal.js/js/reveal.js"></script>

    <script>

        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: false,
            progress: true,
            history: true,
            center: true,
            slideNumber: true,

            transition: 'convex', // none/fade/slide/convex/concave/zoom

            // More info https://github.com/hakimel/reveal.js#dependencies
            dependencies: [
                { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
                { src: 'reveal.js/plugin/notes/notes.js', async: true }
            ]
        });

    </script>

  </body>
</html>
